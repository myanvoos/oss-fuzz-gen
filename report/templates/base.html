<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Experiment results</title>
<link href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css" rel="stylesheet">
<style>
* {
    box-sizing: border-box;
}
html {
    line-height: 1.15;
}
body {
    font-family: sans-serif;
    font-size: 16px;
    background-color: #f7f9fc;  
    color: #1a202c; 
}
body.dark-mode {
    background-color: #1a202c;
    color: #f7fafc;
}
table {
    border-collapse: collapse;
    border-spacing: 0;
}
td, th {
    border-right: 1px #a0aec0 solid;
    border-bottom: 1px #a0aec0 solid;
    padding: 5px;
    text-align: left;
}
.dark-mode td, .dark-mode th {
    border-right: 1px #4a5568 solid;
    border-bottom: 1px #4a5568 solid;
}
td:first-child, th:first-child {
    border-left: 1px #a0aec0 solid;
}
.dark-mode td:first-child, .dark-mode th:first-child {
    border-left: 1px #4a5568 solid;
}
th {
    border-top: 1px #a0aec0 solid;
}
.dark-mode th {
    border-top: 1px #4a5568 solid;
}
tbody tr:nth-child(odd) {
    background-color: #edf2f7;
}
.dark-mode tbody tr:nth-child(odd) {
    background-color: #2d3748;
}
.chat_prompt {
    background-color: #fff7f2;
    max-width: 50%;
    overflow: scroll;
}
.chat_response {
    background-color: #fcfff2;
    max-width: 50%;
    overflow: scroll;
    margin-left: auto;
}
.code-container {
    display: flex;
    border: 1px solid #a0aec0;
    background-color: #edf2f7;
    overflow-x: auto;
    font-family: monospace;
    width: fit-content;
    max-width: 100%;
}
.dark-mode .code-container {
    background-color: #1a202c;
}
.line-numbers {
    margin: 0;
    padding: 0.5em;
    text-align: right;
    background-color: #e2e8f0;
    border-right: 1px solid #a0aec0;
    user-select: none;
    min-width: 2.5em;
    color: #718096;
}
.dark-mode .line-numbers {
    background-color: #1a202c;
}
.code-content {
    margin: 0;
    padding: 0.5em;
    flex-grow: 0;
}
.line-numbers span,
.code-content code {
    display: block;
    line-height: 1.5;
    white-space: pre;
}
.dark-mode .code-content code {
    color: #e2e8f0;
}
</style>
<body 
      x-data="{ 
        darkMode: localStorage.getItem('darkMode') === 'true',
        detailsOpen: true,
        toggleDarkMode() {
          this.darkMode = !this.darkMode;
          localStorage.setItem('darkMode', this.darkMode);
        }
      }" 
      :class="darkMode ? 'bg-gray-900 text-white dark-mode' : 'bg-[#f7f9fc] text-gray-800'">

      DEBUG: python -m report.web -r results -o results-report --serve -t -m vertex_ai-gemini-1.5

  <div class="p-4 shadow-md border-b">
    <div class="flex items-center gap-4 justify-end">
        <button @click="toggleDarkMode()" class="p-2 rounded-full focus:outline-none transition duration-150">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" :class="darkMode ? 'hidden' : 'block'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" :class="darkMode ? 'block' : 'hidden'" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
            </svg>
        </button>
        <div x-data="{ exportOpen: false }" class="relative">
            <button @click="exportOpen = !exportOpen" class="border font-medium py-2 px-4 rounded text-sm shadow flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                <span>Export</span>
            </button>
            
            <div 
                x-show="exportOpen" 
                @click.away="exportOpen = false"
                class="absolute right-0 mt-2 w-48 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5"
                :class="darkMode ? 'bg-gray-800 text-white' : 'bg-white text-gray-800'"
            >
                <div class="py-1" role="menu">
                    <a href="#" class="block px-4 py-2 text-sm" role="menuitem">Export as PDF (.pdf)</a>
                    <a href="#" class="block px-4 py-2 text-sm" role="menuitem">Export as CSV (.csv)</a>
                    <a href="#" class="block px-4 py-2 text-sm" role="menuitem">Export as Excel (.xlsx)</a>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto flex flex-col md:flex-row justify-between items-center">
        <div class="flex flex-col items-center md:items-start">
            <h1 class="text-2xl md:text-3xl font-bold font-mono pb-2">
                {% if benchmark %}
                    Benchmark: {{ benchmark }}
                {% else %}
                    Experiment Report
                {% endif %}
            </h1>
            <p><span class="font-medium">Model:</span> <strong>{{model}}</strong></p>
        </div>

        {% if accumulated_results %}
            <div class="text-center md:text-right space-y-2 text-nowrap flex-shrink-0 min-w-[300px]"
                 x-data="{ 
                    formatDate(timestamp) {
                        const date = new Date(timestamp);
                        const day = date.getDate().toString().padStart(2, '0');
                        const month = date.toLocaleString('en-AU', { month: 'long' });
                        const year = date.getFullYear();
                        const hours = date.getHours().toString().padStart(2, '0');
                        const minutes = date.getMinutes().toString().padStart(2, '0');
                        return `${day} ${month} ${year}, ${hours}:${minutes}`;
                    }
                 }">
                <p class="text-center md:text-left font-bold text-nowrap">
                    {% if time_results.start_time %}
                        <span x-text="formatDate('{{ time_results.start_time }}')"></span>
                        â†’
                        <span x-text="formatDate('{{ time_results.completion_time }}')"></span>
                    {% endif %}
                </p>
                <p class="text-lg md:text-2xl">Build success rate: <strong>{{ accumulated_results.build_rate|percent }}%</strong></p>
            </div>
        {% endif %}
    </div>

    <div class="container mx-auto mt-6">
        <button 
            @click="detailsOpen = !detailsOpen"
            class="w-full flex items-center justify-between p-3 focus:outline-none"
            :class="detailsOpen ? 'border-b' : ''"
        >
            <span class="font-medium">Accumulated Results</span>
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                class="h-5 w-5 transform transition-transform duration-200" 
                :class="detailsOpen ? 'rotate-180' : ''"
                fill="none" 
                viewBox="0 0 24 24" 
                stroke="currentColor"
            >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </button>
        
        <div 
            x-show="detailsOpen" 
            class="mt-4 p-6 rounded-lg grid grid-cols-1 md:grid-cols-2 gap-4 border border-dashed"
        >
            <div class="space-y-2">
                <p><span class="font-medium">Total Benchmarks:</span> {{accumulated_results.total_runs}}</p>
                <p><span class="font-medium">Successful Builds:</span> {{accumulated_results.compiles}}</p>
                <p><span class="font-medium">Average Coverage:</span> {{accumulated_results.average_coverage |percent }}%</p>
            </div>
            <div class="space-y-2">
                <p><span class="font-medium">Coverage Diff:</span> {{accumulated_results.average_line_coverage_diff |percent }}%</p>
                <p><span class="font-medium">Crashes:</span> {{accumulated_results.crashes}}</p>
                <p><span class="font-medium">Total Runtime:</span> {{time_results.total_run_time}}</p>
            </div>
        </div>
    </div>
  </div>

  <nav class="text-base mt-5 container mx-auto">
    <ol class="flex items-center space-x-2">
        <li class="flex items-center space-x-2">
            <svg class="h-4 w-4" :class="darkMode ? 'text-gray-500' : 'text-gray-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <a href="/" class="hover:text-gray-600 transition-colors" :class="darkMode ? 'text-gray-300 hover:text-gray-400' : 'text-gray-600'">
                Main Index
            </a>
        </li>
        
        {% if benchmark %}
        <li class="flex items-center space-x-2">
            <svg class="h-4 w-4" :class="darkMode ? 'text-gray-500' : 'text-gray-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <a href="../../benchmark/{{ benchmark|urlencode }}/index.html" 
               class="hover:text-gray-600 transition-colors"
               :class="darkMode ? 'text-gray-300 hover:text-gray-400' : 'text-gray-600'">
                {{ benchmark }}
            </a>
        </li>
        {% endif %}

        {% if sample %}
        <li class="flex items-center space-x-2">
            <svg class="h-4 w-4" :class="darkMode ? 'text-gray-500' : 'text-gray-400'" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
            <span class="text-gray-500" :class="darkMode ? 'text-gray-400' : 'text-gray-500'">
                Sample {{ sample.id }}
            </span>
        </li>
        {% endif %}
    </ol>
  </nav>
  
  <div class="container mx-auto mt-8 px-4">
    {% block content %}{% endblock %}
  </div>

  <div class="mb-20"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.10.3/cdn.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
</body>